# Today I Learned

|date|ver|
|----|----|
|2022-11-21| v1.0|
|2022-11-23| v1.1|
|2022-11-25| v1.2|

---
## 오늘 배운 것

### dependency injection
* 의존관계 주입
* A -> B 클래스 간의 의존관계가 있을 때 외부에서 객체를 생성해서 넣어주는 것
* B가 바뀔 때 A도 같이 바꿔야 하는 문제를 방지할 수 있음 (DIP, OCP 규칙)
* 의존관계 주입을 위해 Configuration 클래스(@Configuration) 만들어서 구현 객체 생성, 연결을 실행 부분과 분리


### spring bean 등록
* compoment scan으로 등록되게 할 수 있고(@Service, @Repository 등)
* 직접 @Configuration 이용해서 bean 등록 가능
* 최근엔 잘 사용하지 않지만, xml 형식으로도 bean 등록 가능(GenericXmlApplicationContext)

### 의존관계 주입 방법
* 생성자 주입
    * 생성자 `호출` 시점에 1번만 호출되는 것이 보장
    * spring container가 bean 등록하면서 의존관계 주입도 같이 일어남(bean 등록할 때 객체 생성해야 하니까)
    * 불변, 필수 의존관계에 사용
    * spring bean인데 생성자가 1개만 있으면 생성자에 @Autowired 생략 가능
* 수정자 주입 (setter 주입)
    * setter에 @Autowired 붙이면 자동으로 의존관계 주입 해줌 -> setter 호출해서 값 채워줌
    * bean 등록된 후, 의존관계 주입 단계에 주입됨
    * 선택, 변경 가능성 있는 의존관계에 사용
* 필드 주입
    * @Autowired private MemberRepository;
    * 외부에서 변경 불가해서 테스트하기 힘듦(스프링 컨테이너 없이 순수 자바 코드로만 테스트하려고 할 때(직접 new로 객체 생성한다던가), 값을 넣어줄 방법이 없음)
    * 값을 넣어주려면 setter가 필요하고 -> 그럼 그냥 바로 수정자 주입 방법을 쓰는게 낫지
    * DI 프레임워크 없으면 아무것도 못함
    * 사용 안 하는걸 권장하지만
        * 애플리케이션 실제 코드와 관계 없는 테스트나
        * @Configuration 클래스에서는 사용하기도 함
* 일반 메서드 주입
    * 아무 메서드에 @Autowired 사용 가능
    * 한번에 여러 필드 주입 받기 가능하지만 생성자 주입, 수정자 주입으로 다 커버 가능해서 잘 안씀
    * 수정자 주입이랑 거의 유사 - 수정자도 그냥 메서드니까.. 근데 수정자는 필드마다 한 개씩 있는걸 얘는 한번에 다 해주는 정도

* @Autowired 는 스프링 컨테이너가 관리하는 spring bean이어야 가능하다는거 까먹지 말기 - 너무 당연해서 생각 못 할 수 있음

* 생성자 주입을 사용해야 하는 이유
    * 불변
        * 대부분의 의존관계 주입은 애플리케이션 종료시점까지 의존관계 변경할 일 없음 - 변경하면 안되는 경우가 훨씬 더 많음
        * 수정자 주입을 사용하면 setter를 public으로 열어둬야 해서 누군가 실수로 변경할 수도 있고 좋지 않음
    * 누락
        * 프레임워크 없이 순수한 자바 코드를 단위 테스트 하는 경우(수정자 주입이면 코드 까봐야 알지만, 생성자면 바로 알려주니까 누락될 일 없음)
    * final 키워드 사용 가능
        * 생성자에서 혹시 값 세팅 안되었더라도 컴파일 시점에 오류 발생시켜서 알려줌
        * final 키워드 붙으면 필드 선언 시 or 생성자에서만 값 설정 가능함
* 생성자 주입과 수정자 주입은 같이 사용 가능함
* 기본을 생성자 주입으로 가고 필요할 때만 수정자 주입을 옵션으로 부여해서 사용하는게 best
* 필드 주입은 쳐다보지 말라